<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Litho Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Litho Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Architecture Overview | Litho</title><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/architecture-overview"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Architecture Overview | Litho"><meta data-react-helmet="true" name="description" content="Core Concepts"><meta data-react-helmet="true" property="og:description" content="Core Concepts"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/architecture-overview"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/architecture-overview" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/architecture-overview" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7ff81ca3.css">
<link rel="stylesheet" href="/assets/css/main.30634811.css">
<link rel="preload" href="/assets/js/styles.10ad285b.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.efaf1af3.js" as="script">
<link rel="preload" href="/assets/js/main.fc619540.js" as="script">
<link rel="preload" href="/assets/js/1.bef55bbe.js" as="script">
<link rel="preload" href="/assets/js/2.9164bb93.js" as="script">
<link rel="preload" href="/assets/js/101.76b4e9ac.js" as="script">
<link rel="preload" href="/assets/js/104.2357c688.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.a71184da.js" as="script">
<link rel="preload" href="/assets/js/17896441.41a43866.js" as="script">
<link rel="preload" href="/assets/js/dcde5f92.224b3774.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Litho</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Litho</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro/motivation">Docs</a></li><li class="menu__list-item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="menu__link">API</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial/overview">Tutorial</a></li><li class="menu__list-item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Architecture Overview</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="core-concepts"></a>Core Concepts<a class="hash-link" href="#core-concepts" title="Direct link to heading">#</a></h2><ul><li><strong>Component</strong>. A bundle of immutable data (Props) and pure functions that can transform the props into UI.</li><li><strong>LithoView</strong>. A subclass of <code>android.view.ViewGroup</code> that is used to render a <code>Component</code>.</li><li><strong>ComponentTree</strong>. A class that holds a single root <code>Component</code> and controls its lifecycle.</li><li><strong>LayoutState</strong>. Responsible for calculating a layout and holding onto the output of the calculation.</li><li><strong>MountState</strong>. Responsible for mounting the <code>Component</code> into a <code>LithoView</code>. Each <code>LithoView</code> has exactly one <code>MountState</code>.</li><li><strong>InternalNode</strong>. Class which represents a single node in the layout of a <code>Component</code>.</li><li><strong>LayoutOutput</strong>. Lightweight representation of the output of the layout pass. The <code>LayoutState</code> produces a List of <code>LayoutOutput</code>s that are then mounted by the <code>MountState</code>.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="litho-lesson-component-to-screen"></a>Litho Lesson: Component to Screen<a class="hash-link" href="#litho-lesson-component-to-screen" title="Direct link to heading">#</a></h2><p>We recommend you start by watching this video: it covers most of the core concepts above, as well as the fundamentals of how a Litho component gets turned into a <code>View</code> on screen.</p><iframe padding-top="10px" width="560" height="315" src="https://www.youtube-nocookie.com/embed/t9wTHnCx5RM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="layout"></a>Layout<a class="hash-link" href="#layout" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initializing-layout"></a>Initializing Layout<a class="hash-link" href="#initializing-layout" title="Direct link to heading">#</a></h3><p>Layout calculation is controlled by the <code>ComponentTree</code>. There are two mains ways that a <code>ComponentTree</code> will kick off a layout calculation:</p><ol><li>If the bounds are known in advance, then the user can call <code>setSizeSpec</code>/<code>setSizeSpecAsync</code> directly.</li><li>When the <code>ComponentTree</code> is set on a <code>LithoView</code>, then <code>LithoView#onMeasure()</code> will cause a layout to be calculated, unless the <code>ComponentTree</code> already has a valid layout (e.g. from an earlier <code>setSizeSpecAsync</code> call).</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="calculating-layout"></a>Calculating Layout<a class="hash-link" href="#calculating-layout" title="Direct link to heading">#</a></h3><ol><li><code>LayoutState#createTree</code>. The first step in calculating layout is creating the tree of components (a tree of <code>InternalNode</code>s). This is done by recursively resolving each Component in the hierarchy, which for <code>Row</code> and <code>Column</code> means creating a new <code>InternalNode</code> and adding each of their children, and for all other Components just means calling <code>onCreateLayout</code>.</li><li><code>LayoutState#measureTree</code>. The second step in the calculation is measuring the tree. To do this the <code>InternalNode</code>s just defer to their underlying Yoga nodes, and Yoga does the calculation for us.</li><li><code>LayoutState#collectResults</code>. Now that we have created and measured the tree, we collect the results into a lightweight representation of elements that need mounting and throw away the <code>InternalNode</code> tree.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="layout-diffing"></a>Layout Diffing<a class="hash-link" href="#layout-diffing" title="Direct link to heading">#</a></h3><p>When calculating new layout on a <code>ComponentTree</code> that already has an existing layout, it is common that much of the layout is actually quite similar to before (e.g. you might change the color of an icon when you click on it, but leave the remaining UI the same). In order to take advantage of the similarities in cases such as this, we do something called <code>layoutDiffing</code>. Each <code>LayoutState</code> that we create has a tree of <code>DiffNode</code>s that store the results of the layout that we calculated, including measurements. When creating a new <code>LayoutState</code> for a <code>ComponentTree</code> that already has one, we use the <code>DiffNode</code> tree to skip work where possible.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mount"></a>Mount<a class="hash-link" href="#mount" title="Direct link to heading">#</a></h2><p>Mount (<code>MountState#mount</code>) takes place for the first time when the <code>LithoView</code> is first laid out, and again every time the visible portion of the <code>LithoView</code> changes (provided that incremental mount is enabled). The mount step receives a <code>Rect</code> indicating the current visible area of the LithoView, and it uses that <code>Rect</code> to determine which of the <code>LayoutOutput</code>s from the Layout phase need to be either mounted (if they are now on the screen and they weren&#x27;t before) or unmounted (if they are no longer on the screen).</p><p>For each Component that needs to be mounted, we first acquire the <code>View</code>/<code>Drawable</code> defined in the <code>MountSpec</code>&#x27;s <code>onCreateMountContent</code> method. If possible, we acquire the mount content from our recycling pool (which is stored on a per-context basis), but if the pool is empty, then we create a new one. After that, we call <code>mount</code>, and then <code>bind</code>. When unmounting, we call <code>unbind</code> and then <code>unmount</code>.</p><p>Each time mount is called, we also call <code>MountState#processVisibilityOutputs</code>, which determines whether any visibility events need to be fired, and fires them if so.</p><p>Mounting (including firing visibility events) is bound to the UI thread, so operations called here should be as lightweight as possible.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mount-diffing"></a>Mount Diffing<a class="hash-link" href="#mount-diffing" title="Direct link to heading">#</a></h3><p>Mount diffing is a technique that Litho uses to avoid unmounting and mounting content when it is not necessary. Before mounting, we look at the currently mounted content and compare it with the content that we want to mount. If the currently mounted content does not need updating, then we don&#x27;t call <code>unmount</code>/<code>mount</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/architecture-overview.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#core-concepts" class="table-of-contents__link">Core Concepts</a></li><li><a href="#litho-lesson-component-to-screen" class="table-of-contents__link">Litho Lesson: Component to Screen</a></li><li><a href="#layout" class="table-of-contents__link">Layout</a><ul><li><a href="#initializing-layout" class="table-of-contents__link">Initializing Layout</a></li><li><a href="#calculating-layout" class="table-of-contents__link">Calculating Layout</a></li><li><a href="#layout-diffing" class="table-of-contents__link">Layout Diffing</a></li></ul></li><li><a href="#mount" class="table-of-contents__link">Mount</a><ul><li><a href="#mount-diffing" class="table-of-contents__link">Mount Diffing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Open Source</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Open Source Projects</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/styles.10ad285b.js"></script>
<script src="/assets/js/runtime~main.efaf1af3.js"></script>
<script src="/assets/js/main.fc619540.js"></script>
<script src="/assets/js/1.bef55bbe.js"></script>
<script src="/assets/js/2.9164bb93.js"></script>
<script src="/assets/js/101.76b4e9ac.js"></script>
<script src="/assets/js/104.2357c688.js"></script>
<script src="/assets/js/935f2afb.a71184da.js"></script>
<script src="/assets/js/17896441.41a43866.js"></script>
<script src="/assets/js/dcde5f92.224b3774.js"></script>
</body>
</html>